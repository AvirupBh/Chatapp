{"ast":null,"code":"var _jsxFileName = \"/home/avirup/chatapp/chat-app-master/inner/src/App.js\",\n    _s = $RefreshSig$();\n\nimport './App.css';\nimport io from \"socket.io-client\";\nimport logo from \"./assets/chat.png\";\nimport { useEffect, useRef, useState } from \"react\";\nimport CreateUser from './components/CreateUser';\nimport OnlineUsers from './components/OnlineUsers';\nimport MessagesControl from './components/MessagesControl';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io(`http://localhost:5000`);\n\nfunction App() {\n  _s();\n\n  const [step, setStep] = useState(0);\n  const [username, setUsername] = useState(\"\");\n  const [receiver, setReceiver] = useState(\"\");\n  const [avatar, setAvatar] = useState(\"\");\n  const [media, setMedia] = useState(null);\n  const [users, setUsers] = useState({});\n  const [message, setMessage] = useState(\"\");\n  const [groupMessage, setGroupMessage] = useState({});\n  const receiverRef = useRef(null);\n\n  const showImage = url => {\n    window.open(url);\n    console.log(url);\n  };\n\n  const sortNames = (username1, username2) => {\n    return [username1, username2].sort().join(\"-\");\n  };\n\n  const onCreateUser = () => {\n    console.log(username);\n    socket.emit(\"new_user\", username);\n    const a = Math.ceil(Math.random() * 8) + '.png';\n    setAvatar(a);\n    setStep(prevStep => prevStep + 1);\n  };\n\n  const onUserSelect = username => {\n    setReceiver(username);\n    receiverRef.current = username;\n    setStep(prevStep => prevStep + 1);\n  };\n\n  const onChatClose = () => {\n    setStep(1);\n    receiverRef.current = null;\n  };\n\n  const gotoBottom = () => {\n    const el = document.querySelector(\".message-area ul\");\n\n    if (el) {\n      el.scrollTop = el.scrollHeight;\n    }\n  };\n\n  const sendMessage = e => {\n    e.preventDefault();\n    const data = {\n      sender: username,\n      receiver,\n      message,\n      media,\n      avatar,\n      view: false\n    }; //here we are sending messages\n\n    socket.emit(\"send_message\", data); //Main Model: Generate a unique key for each pair of sender-receiver\n    //eg: sender: Koushan, receiver:Avirup => key: \"Avirup-Koushan\" (Sorted in alphabetical order and joined with a hiphen)\n\n    const key = sortNames(username, receiver);\n    const tempGroupMessage = { ...groupMessage\n    };\n\n    if (key in tempGroupMessage) {\n      tempGroupMessage[key] = [...tempGroupMessage[key], { ...data,\n        view: true\n      }];\n    } else {\n      tempGroupMessage[key] = [{ ...data,\n        view: true\n      }];\n    }\n\n    setGroupMessage({ ...tempGroupMessage\n    });\n\n    if (media !== null) {\n      setMedia(null);\n    }\n\n    setMessage(\"\");\n    console.log(groupMessage);\n    console.log(message);\n  };\n\n  const checkUnseenMessages = receiver => {\n    const key = sortNames(username, receiver);\n    let unseenMessages = [];\n\n    if (key in groupMessage) {\n      unseenMessages = groupMessage[key].filter(mgs => !mgs.view);\n    }\n\n    return unseenMessages.length;\n  };\n\n  useEffect(() => {\n    socket.on(\"all_users\", users => {\n      console.log({\n        users\n      });\n      setUsers(users);\n    });\n    socket.on(\"new_message\", data => {\n      console.log(data);\n      console.log({\n        rec: receiverRef.current,\n        data\n      });\n      setGroupMessage(prevGroupMessage => {\n        const messages = { ...prevGroupMessage\n        };\n        const key = sortNames(data.sender, data.receiver);\n\n        if (receiverRef.current === data.sender) {\n          data.view = true;\n        }\n\n        if (key in messages) {\n          messages[key] = [...messages[key], data];\n        } else {\n          messages[key] = [data];\n        }\n\n        return { ...messages\n        };\n      });\n    });\n  }, []);\n  useEffect(() => {\n    //for updating view count of selected user(receiver)\n    updateViewMessage();\n  }, [receiver]);\n\n  const updateViewMessage = () => {\n    const key = sortNames(username, receiver);\n\n    if (key in groupMessage) {\n      const messages = groupMessage[key].map(msg => !msg.view ? { ...msg,\n        view: true\n      } : msg);\n      groupMessage[key] = [...messages];\n      setGroupMessage({ ...groupMessage\n      });\n    }\n  };\n\n  useEffect(() => {\n    const key = sortNames(username, receiver);\n\n    if (key in groupMessage) {\n      if (groupMessage[key].length > 0) {\n        gotoBottom();\n      }\n    }\n  }, [groupMessage]); //console.log(groupMessage);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"app-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: logo,\n        alt: \"Chatter-logo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"app-name\",\n        children: \"Chatter\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-system\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-box\",\n        children: [\n        /* step1 ask user name and password*/\n        step === 0 ? /*#__PURE__*/_jsxDEV(CreateUser, {\n          onCreateUser: onCreateUser,\n          value: username,\n          onChange: e => setUsername(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 15\n        }, this) : null,\n        /* step2 show all available users*/\n        step === 1 ? /*#__PURE__*/_jsxDEV(OnlineUsers, {\n          onUserSelect: onUserSelect,\n          users: users,\n          username: username,\n          checkUnseenMessages: checkUnseenMessages\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 15\n        }, this) : null,\n        /* step3 select user and switch to chat window*/\n        step === 2 ? /*#__PURE__*/_jsxDEV(MessagesControl, {\n          value: message,\n          onChange: e => setMessage(e.target.value),\n          sendMessage: sendMessage,\n          groupMessage: groupMessage,\n          sortNames: sortNames,\n          username: username,\n          receiver: receiver,\n          setMedia: setMedia,\n          onChatClose: onChatClose,\n          media: media,\n          showImage: showImage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 15\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 172,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"oheZkqF1Y4yD47G47rojuN+yBXo=\");\n\n_c = App;\nexport default App; //54:14\n//1:06:00\n//2:14:56\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/home/avirup/chatapp/chat-app-master/inner/src/App.js"],"names":["io","logo","useEffect","useRef","useState","CreateUser","OnlineUsers","MessagesControl","socket","App","step","setStep","username","setUsername","receiver","setReceiver","avatar","setAvatar","media","setMedia","users","setUsers","message","setMessage","groupMessage","setGroupMessage","receiverRef","showImage","url","window","open","console","log","sortNames","username1","username2","sort","join","onCreateUser","emit","a","Math","ceil","random","prevStep","onUserSelect","current","onChatClose","gotoBottom","el","document","querySelector","scrollTop","scrollHeight","sendMessage","e","preventDefault","data","sender","view","key","tempGroupMessage","checkUnseenMessages","unseenMessages","filter","mgs","length","on","rec","prevGroupMessage","messages","updateViewMessage","map","msg","target","value"],"mappings":"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","sourcesContent":["\nimport './App.css';\nimport io from \"socket.io-client\";\nimport logo from \"./assets/chat.png\"\nimport { useEffect, useRef, useState } from \"react\";\nimport CreateUser from './components/CreateUser';\nimport OnlineUsers from './components/OnlineUsers';\nimport MessagesControl from './components/MessagesControl';\n\nconst socket = io(`http://localhost:5000`);\n\nfunction App() {\n\n  const [step, setStep] = useState(0);\n  const [username,setUsername] = useState(\"\");\n  const [receiver, setReceiver] = useState(\"\");\n  const [avatar, setAvatar] = useState(\"\");\n  const [media, setMedia] = useState(null);\n  const [users, setUsers] = useState({});\n  const [message, setMessage] = useState(\"\");\n  const [groupMessage, setGroupMessage] = useState({});\n  const receiverRef = useRef(null);\n\n  const showImage = (url) => {\n    window.open(url)\n    console.log(url)\n  }\n  const sortNames = (username1,username2) => {\n    return [username1,username2].sort().join(\"-\");\n  };\n\n  const onCreateUser = () => {\n    console.log(username);\n\n    socket.emit(\"new_user\", username);\n    const a = Math.ceil(Math.random() * 8) + '.png';\n    setAvatar(a);\n\n    setStep(prevStep => prevStep + 1);\n  }\n\n  const onUserSelect = (username) => {\n    setReceiver(username);\n    receiverRef.current = username; \n    setStep(prevStep => prevStep + 1);\n  }\n\n  const onChatClose = () =>{\n    setStep(1);\n    receiverRef.current=null;\n  }\n\n  const gotoBottom = () =>{\n    const el = document.querySelector(\".message-area ul\");\n    if(el){\n      el.scrollTop = el.scrollHeight;\n    }\n  }\n\n  const sendMessage = (e) => {\n    e.preventDefault();\n\n    const data = {\n      sender : username,\n      receiver,\n      message,\n      media,\n      avatar,\n      view: false,\n    };\n\n    //here we are sending messages\n    socket.emit(\"send_message\",data);\n    \n    //Main Model: Generate a unique key for each pair of sender-receiver\n    //eg: sender: Koushan, receiver:Avirup => key: \"Avirup-Koushan\" (Sorted in alphabetical order and joined with a hiphen)\n    const key = sortNames(username, receiver);\n    const tempGroupMessage = {...groupMessage};\n\n    if(key in tempGroupMessage)\n    {\n      tempGroupMessage[key] = [...tempGroupMessage[key], {...data, view: true}];\n    }\n    else{\n      tempGroupMessage[key] = [{...data, view:true}];\n    }\n\n    setGroupMessage({ ...tempGroupMessage });\n\n    if(media !== null){\n      setMedia(null);\n    }\n\n    setMessage(\"\");\n\n     console.log(groupMessage);\n\n     console.log(message);     \n  };\n\n  const checkUnseenMessages = (receiver)=>{\n    \n    const key = sortNames(username, receiver);\n    let unseenMessages = [];\n    if(key in groupMessage){\n      unseenMessages = groupMessage[key].filter(mgs => !mgs.view);\n    }\n\n    return unseenMessages.length;\n  }\n\n  useEffect(()=>{\n    socket.on(\"all_users\", (users) => {\n      console.log({users});\n      setUsers(users);\n    });\n\n    socket.on(\"new_message\", (data)=>{\n      console.log(data);\n\n       console.log({rec: receiverRef.current,data});\n\n      setGroupMessage((prevGroupMessage) => {\n        const messages = {...prevGroupMessage};\n        const key = sortNames(data.sender,data.receiver);\n\n        if(receiverRef.current === data.sender){\n          data.view = true;\n        }\n\n\n        if(key in messages){\n          messages[key] = [...messages[key], data];\n        }\n        else{\n          messages[key] = [data];\n        }\n\n        return {...messages};\n      })\n    })\n  }, []);\n\n  useEffect(()=>{\n    //for updating view count of selected user(receiver)\n    updateViewMessage();\n  },[receiver]);\n\n  const updateViewMessage = ()=>{\n    const key = sortNames(username,receiver);\n    if(key in groupMessage){\n      const messages = groupMessage[key].map(msg => !msg.view ? {...msg, view:true} : msg);\n\n      groupMessage[key] = [...messages];\n\n      setGroupMessage({...groupMessage});\n    }\n  }\n\n  useEffect(() => {\n    const key = sortNames(username,receiver);\n    if(key in groupMessage){\n      if(groupMessage[key].length > 0){\n        gotoBottom();\n      }\n    }\n  }, [groupMessage]);\n\n  //console.log(groupMessage);\n\n  return (\n    <div className=\"App\">\n      <header className=\"app-header\">\n        <img src={logo} alt=\"Chatter-logo\" />\n        <div className=\"app-name\">Chatter</div>\n      </header>\n      <div className=\"chat-system\">\n        <div className=\"chat-box\">\n          {\n            /* step1 ask user name and password*/\n            step === 0 ? (\n              <CreateUser onCreateUser = {onCreateUser}\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}/>) : null}\n          {/* step2 show all available users*/\n            step === 1 ? (\n              <OnlineUsers onUserSelect = {onUserSelect}\n              users = {users}\n              username = {username}\n              checkUnseenMessages={checkUnseenMessages}\n              />\n            ) : null\n          }\n          {/* step3 select user and switch to chat window*/\n            step === 2 ? (\n              <MessagesControl\n              value = {message}\n              onChange =  {(e)=>setMessage(e.target.value)}\n              sendMessage = {sendMessage}\n              groupMessage = {groupMessage}\n              sortNames = {sortNames}\n              username = {username}\n              receiver = {receiver}\n              setMedia = {setMedia}\n              onChatClose={onChatClose}\n              media = {media}\n              showImage = {showImage}\n              />\n            ) : null\n          }\n        </div>\n\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n\n\n//54:14\n//1:06:00\n//2:14:56"]},"metadata":{},"sourceType":"module"}